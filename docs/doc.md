# **–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –ê–≤–∏—Ç–æ**

## **–≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**

### **–®–∞–≥ 1.1 - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:

**–¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á** - —Ö—Ä–∞–Ω–∏—Ç –∞—Ä—Ç–∏–∫—É–ª—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞, —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–æ–≤–∞—è, –≤ —Ä–∞–±–æ—Ç–µ, –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ—à–∏–±–∫–∞), –≤—Ä–µ–º—è –≤–∑—è—Ç–∏—è –∑–∞–¥–∞—á–∏ –≤–æ—Ä–∫–µ—Ä–æ–º, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–æ—Ä–∫–µ—Ä–∞, –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ heartbeat

**–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–∫—Å–∏** - —Ö—Ä–∞–Ω–∏—Ç –∞–¥—Ä–µ—Å–∞ –ø—Ä–æ–∫—Å–∏, —Å—Ç–∞—Ç—É—Å (—Å–≤–æ–±–æ–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω), –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞

**–¢–∞–±–ª–∏—Ü–∞ —Å–ø–∞—Ä—à–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫** - —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –ê–≤–∏—Ç–æ, —Å–≤—è–∑—å —Å –∞—Ä—Ç–∏–∫—É–ª–æ–º, –≤—Å–µ —Å–ø–∞—Ä—à–µ–Ω–Ω—ã–µ –ø–æ–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏, –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞

**–¢–∞–±–ª–∏—Ü–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - —Ö—Ä–∞–Ω–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è, —Ç–∏–ø –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –∏–ª–∏ –ò–ò), —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–æ—à–ª–æ –∏–ª–∏ –Ω–µ—Ç), –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è, –≤—Ä–µ–º—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏** - —Ö—Ä–∞–Ω–∏—Ç –∞—Ä—Ç–∏–∫—É–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø–æ–ª—è–º.

### **–®–∞–≥ 1.2 - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã docker compose –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¢–û–õ–¨–ö–û –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (`/root/avito_zamer_complex-1/`)!

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞:
```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd /root/avito_zamer_complex-1

# –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f
```

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (–Ω–µ 15!)
- –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ supervisor —É–ø—Ä–∞–≤–ª—è–µ—Ç NUM_WORKERS –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15)
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (multiprocessing) —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏

### **–®–∞–≥ 1.3 - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Python 3.11+ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- Playwright Chromium (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `playwright install chromium`)
- avito-library - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- asyncpg - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- openai - –¥–ª—è –ò–ò-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Gemini

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
- –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤–æ—Ä–∫–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `check_dependencies.py`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∏ –≤–µ—Ä—Å–∏—è Python (—Ç—Ä–µ–±—É–µ—Ç—Å—è 3.11+)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ avito-library –∏ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ Chromium –¥–ª—è Playwright
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ asyncpg –∏ openai
- –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ

**–í–ê–ñ–ù–û:** avito-library —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é. –í–æ—Ä–∫–µ—Ä –ù–ï –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ –Ω–µ—ë (–Ω–µ—Ç —Ä–µ–∂–∏–º–∞ –∑–∞–≥–ª—É—à–∫–∏).

## **–≠–¢–ê–ü 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
- `scripts/db_utils.py` - –æ–±—â–∏–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `scripts/add_tasks.py` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –∏–∑ `scripts/data/urls.txt`
- `scripts/manage_proxies.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –∏–∑ `scripts/data/proxies.txt`
- `scripts/clear_database.py` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü
- `scripts/monitor.py` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞—Ç—á–µ–≤—É—é –≤—Å—Ç–∞–≤–∫—É (1000 –∑–∞–ø–∏—Å–µ–π), –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î.

### **–®–∞–≥ 2.1 - –°–∫—Ä–∏–ø—Ç –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–¥–∞—á**
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ –ë–î, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–∑–¥–∞–µ—Ç –∏—Ö
- –ß–∏—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
- –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–∑ –ë–î —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –∏—Ö
- –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ª–∏–±–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º, –ª–∏–±–æ –æ—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–Ω–æ–≤–æ
- –ö–∞–∂–¥—ã–π –∞—Ä—Ç–∏–∫—É–ª –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤–∞—è"

### **–®–∞–≥ 2.2 - –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏**
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ª–∏–±–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º, –ª–∏–±–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
- –í—Å–µ –ø—Ä–æ–∫—Å–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å "—Å–≤–æ–±–æ–¥–µ–Ω"

### **–®–∞–≥ 2.3 - –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î**
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ë–î:
- –ú–æ–∂–µ—Ç –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞
- –ú–æ–∂–µ—Ç –æ—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **–®–∞–≥ 2.4 - –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏, –≤ —Ä–∞–±–æ—Ç–µ, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–æ–∫—Å–∏ (—Å–≤–æ–±–æ–¥–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è)
- –ê–∫—Ç–∏–≤–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –∏ –∏—Ö —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

## **–≠–¢–ê–ü 3: –†–∞–±–æ—Ç–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –û–¢–õ–ê–ñ–ï–ù–û**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `container/worker/config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `container/worker/errors.py` - –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- `container/worker/database.py` - 12 —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–±–æ—Ç—ã —Å –ë–î (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- `container/worker/browser.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Playwright –±—Ä–∞—É–∑–µ—Ä–æ–º
- `container/worker/main.py` - –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –≤–æ—Ä–∫–µ—Ä–∞ —Å –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –≤–æ—Ä–∫–µ—Ä—ã - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ PostgreSQL –ë–î
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å FOR UPDATE SKIP LOCKED
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–∫—Å–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
- Graceful shutdown –ø—Ä–∏ SIGTERM
- Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 120 —Å–µ–∫) —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–¥–∞—á (timeout 1 —á–∞—Å)
- Retry –º–µ—Ö–∞–Ω–∏–∑–º (–º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –∑–∞–¥–∞—á—É)

**–§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ pool –≤ heartbeat_loop –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫—Ä–∞—à–∞ –ø—Ä–∏ shutdown
2. –í—Å–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ current_proxy_id –≤ main_loop –∑–∞—â–∏—â–µ–Ω—ã asyncio.Lock (4 –º–µ—Å—Ç–∞)
3. –î–æ–±–∞–≤–ª–µ–Ω cleanup –±—Ä–∞—É–∑–µ—Ä–∞ –≤ coordinator –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –∫–∞–ø—á–µ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤)
4. –ó–∞–º–µ–Ω–∞ break –Ω–∞ raise –≤ coordinator –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ main_loop)
5. –û—Ç–º–µ–Ω–∞ heartbeat –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ finally –±–ª–æ–∫ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
6. –î–æ–±–∞–≤–ª–µ–Ω cleanup –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ OOM)
7. POOL_MAX_SIZE —É–º–µ–Ω—å—à–µ–Ω —Å 10 –¥–æ 5 (75 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π < 100 –ª–∏–º–∏—Ç PostgreSQL)
8. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Dockerfile: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python 3.11 —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ø–∞–∫–µ—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Chromium —á–µ—Ä–µ–∑ `playwright install chromium`
9. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ `check_dependencies.py` –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º –≤–æ—Ä–∫–µ—Ä–∞
10. –£–¥–∞–ª–µ–Ω —Ä–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏ - –≤–æ—Ä–∫–µ—Ä –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ avito-library
11. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ multiprocessing** - –ø–µ—Ä–µ—Ö–æ–¥ —Å 15 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ 1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä + N –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ supervisor
12. **Security fix**: –ü–∞—Ä–æ–ª—å –ë–î —É–¥–∞–ª–µ–Ω –∏–∑ healthcheck –∫–æ–º–∞–Ω–¥—ã –≤ docker-compose.yml, —Å–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `container/healthcheck.sh`
13. –î–æ–±–∞–≤–ª–µ–Ω timeout (5 —Å–µ–∫) –≤ `process.join()` –ø–æ—Å–ª–µ `kill()` –≤ supervisor –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–∏ zombie –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö
14. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω signal handling –≤ multiprocessing - child –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ SIG_DFL, —Ç–æ–ª—å–∫–æ supervisor –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã
15. –î–æ–±–∞–≤–ª–µ–Ω timeout (10 —Å–µ–∫) –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç exceptions –ø—Ä–∏ cleanup –±—Ä–∞—É–∑–µ—Ä–∞ –≤ worker/main.py –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
16. –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π cleanup —Ä–µ—Å—É—Ä—Å–æ–≤ (–±—Ä–∞—É–∑–µ—Ä + –ø—Ä–æ–∫—Å–∏ + –ë–î) –≤ exception handler –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ worker
17. Xvfb –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç orphans —á–µ—Ä–µ–∑ trap –º–µ—Ö–∞–Ω–∏–∑–º –≤ entrypoint.sh —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º cleanup –ø—Ä–∏ EXIT/SIGTERM/SIGINT
18. Race condition –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Xvfb —É—Å—Ç—Ä–∞–Ω–µ–Ω - –∑–∞–º–µ–Ω–µ–Ω `sleep 3` –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É X11 sockets —Å timeout 30 —Å–µ–∫
19. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `running` –≤ supervisor –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `multiprocessing.Event()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ shutdown
20. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** - —É–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `container/docker-compose.yml` —Å `replicas: 15`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–ª 15√ó15=225 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–º–µ—Å—Ç–æ 15. –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤–æ–π docker-compose.yml —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä + supervisor + N –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
21. **Deadlock —Ä–∏—Å–∫ —É—Å—Ç—Ä–∞–Ω–µ–Ω** - cleanup –∏ launch –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–Ω–µ—Å–µ–Ω—ã –∏–∑ `state_lock` –≤ coordinator_task (3 –º–µ—Å—Ç–∞), –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ network issues
22. **Zombie Xvfb –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ zombie –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ entrypoint.sh —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `wait` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ reap
23. **Healthcheck —É–ª—É—á—à–µ–Ω** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ heartbeat –≤–æ—Ä–∫–µ—Ä–æ–≤ (fail –µ—Å–ª–∏ –Ω–µ—Ç heartbeat > 5 –º–∏–Ω—É—Ç), –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –ø–æ–∑–∏—Ç–∏–≤—ã –ø—Ä–∏ –º–µ—Ä—Ç–≤—ã—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö
24. **–ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è supervisor** - timeout –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É–º–µ–Ω—å—à–µ–Ω —Å 5 –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É–ø–∞–≤—à–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
25. **–£–≤–µ–ª–∏—á–µ–Ω shm_size** - —Å 4GB –¥–æ 6GB –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã 15 –±—Ä–∞—É–∑–µ—Ä–æ–≤ Chromium –Ω–∞ –ø–∏–∫–∞—Ö –Ω–∞–≥—Ä—É–∑–∫–∏
26. **–†—É—Å—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å—Ö–µ–º–æ–π –ë–î (—Ä—É—Å—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã) –∏ healthcheck.sh (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ). –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã: '–Ω–æ–≤–∞—è', '–≤ —Ä–∞–±–æ—Ç–µ', '–∑–∞–≤–µ—Ä—à–µ–Ω–∞', '–æ—à–∏–±–∫–∞' –¥–ª—è tasks –∏ '—Å–≤–æ–±–æ–¥–µ–Ω', '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è', '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' –¥–ª—è proxies

–í—Å–µ race conditions —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, —É—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∑–∞–∫—Ä—ã—Ç—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

### **–®–∞–≥ 3.1 - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ—Ä–∫–µ—Ä–∞**
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä:
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ `check_dependencies.py`
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ avito-library –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π
- –õ–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é avito-library
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î
- –í—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ–∑–≤—Ä–∞—Ç–∞ "–∑–∞–≤–∏—Å—à–∏—Ö" –∑–∞–¥–∞—á - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "–≤ —Ä–∞–±–æ—Ç–µ", –≥–¥–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ heartbeat –±–æ–ª—å—à–µ —á–∞—Å–∞ –Ω–∞–∑–∞–¥, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤ —Å—Ç–∞—Ç—É—Å "–Ω–æ–≤–∞—è"
- –ì–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–¥–∞—á

### **–®–∞–≥ 3.2 - –í–∑—è—Ç–∏–µ –∑–∞–¥–∞—á–∏**
–í–æ—Ä–∫–µ—Ä –≤ —Ü–∏–∫–ª–µ:
- –ê—Ç–æ–º–∞—Ä–Ω–æ –±–µ—Ä–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤–∞—è" (–º–µ—Ö–∞–Ω–∏–∑–º –¥–æ–ª–∂–µ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –¥–≤–∞ –≤–æ—Ä–∫–µ—Ä–∞ –Ω–µ –≤–æ–∑—å–º—É—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É)
- –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–≤ —Ä–∞–±–æ—Ç–µ", –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ –≤—Ä–µ–º—è –≤–∑—è—Ç–∏—è
- –ï—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç - –∂–¥–µ—Ç –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç

### **–®–∞–≥ 3.3 - –í–∑—è—Ç–∏–µ –ø—Ä–æ–∫—Å–∏**
- –í–æ—Ä–∫–µ—Ä –∞—Ç–æ–º–∞—Ä–Ω–æ –±–µ—Ä–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–∫—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "—Å–≤–æ–±–æ–¥–µ–Ω"
- –ú–µ–Ω—è–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å –Ω–∞ "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è", –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –ï—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏ –Ω–µ—Ç - –≤–æ—Ä–∫–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É, –Ω–µ –±–µ—Ä–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏


### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ multiprocessing**
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤:
- **–û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker** –∑–∞–ø—É—Å–∫–∞–µ—Ç supervisor
- **Supervisor (supervisor.py)** —É–ø—Ä–∞–≤–ª—è–µ—Ç N –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ multiprocessing
- **–ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å** - –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ—Ä–∫–µ—Ä (asyncio)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** - supervisor –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —É–ø–∞–≤—à–∏–µ
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ** - NUM_WORKERS –∑–∞–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15)

### **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –¥–∏—Å–ø–ª–µ–∏ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤**
–î–ª—è —Ä–∞–±–æ—Ç—ã –±—Ä–∞—É–∑–µ—Ä–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±–µ–∑ GUI –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –¥–∏—Å–ø–ª–µ–∏:
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è NUM_WORKERS —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Xvfb
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∏—Å–ø–ª–µ–π
- –î–∏—Å–ø–ª–µ–∏: :99, :100, :101, ..., :99+NUM_WORKERS-1
- Worker 1 ‚Üí DISPLAY=:99, Worker 2 ‚Üí DISPLAY=:100, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ

### **–®–∞–≥ 3.4 - –ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞**
- –í–æ—Ä–∫–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø—Ä–æ–∫—Å–∏
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ª–≥–æ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### **–®–∞–≥ 3.5 - Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º**
- –í–æ—Ä–∫–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Ä–µ–º—è heartbeat –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –≤ –ë–î
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤–æ—Ä–∫–µ—Ä—ã –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö

## **–≠–¢–ê–ü 4: –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–∞–ª–æ–≥–∞**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –û–¢–õ–ê–ñ–ï–ù–û**

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ç—Ç–µ—Ä–Ω "–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä-–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä":
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä - `parse_catalog_until_complete` –∏–∑ avito-library
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä - –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (PageRequest)
- –û–±–º–µ–Ω —á–µ—Ä–µ–∑ PageExchange (–¥–≤–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:
- –ë–ï–ó –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º - –ø–∞—Ä—Å–∏–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫–∞–ø—á–∏ –¥–ª—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤: CAPTCHA_DETECTOR_ID, CONTINUE_BUTTON_DETECTOR_ID, PROXY_BLOCK_429_DETECTOR_ID
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (403/407)
- Retry –ª–æ–≥–∏–∫–∞ —Å –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –Ω–∞ –æ—à–∏–±–∫—É
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ orchestrator_task –∏ coordinator_task —á–µ—Ä–µ–∑ asyncio.gather()
- –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions —Å –ø–æ–º–æ—â—å—é asyncio.Lock
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å cleanup —Ä–µ—Å—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ finally –±–ª–æ–∫–∏

### **–®–∞–≥ 4.1 - –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥**
- –í–æ—Ä–∫–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ê–≤–∏—Ç–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### **–®–∞–≥ 4.2 - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞**
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞:
- **–ü—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (403/407)** - –ø–æ–º–µ—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏ –∫–∞–∫ "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω", –±–µ—Ä–µ—Ç –Ω–æ–≤—ã–π (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥—Ä—è–¥) –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–æ–≥–æ –∂–µ –∞—Ä—Ç–∏–∫—É–ª–∞; –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∏–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å –±–µ–∑ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `no_results`
- **–ö–∞–ø—á–∞ (continue_button, 429, geetest)** - –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ—à–µ–Ω–∏—è –∫–∞–ø—á–∏ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞** - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø–∞—Ä—Å–∏–Ω–≥—É
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ** - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π –Ω–∞ —ç—Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±—Ä–∞—É–∑–µ—Ä–∞

### **–®–∞–≥ 4.3 - –°–±–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞—Ç–∞–ª–æ–≥–∞: –æ–Ω —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω—É, –Ω–∏–∫ –ø—Ä–æ–¥–∞–≤—Ü–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ–µ
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `parse_catalog_until_complete` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª—è `title`, `price`, `seller_name`, `snippet`, `published` ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –†–µ–∑—É–ª—å—Ç–∞—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (`CatalogListing`) –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ —Å–ª–æ–≤–∞—Ä—å: `item_id` ‚Üí `avito_item_id` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã), `snippet_text` ‚Üí `description`, `seller_name` ‚Üí `seller`, —Ü–µ–Ω–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ —á–∏—Å–ª—É, —á—Ç–æ–±—ã –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ë–î —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –µ–¥–∏–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ `CatalogParseMeta` –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —Å–ª–æ–≤–∞—Ä—é —Å–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–º —Å—Ç–∞—Ç—É—Å–æ–º –∏ —Ñ–ª–∞–≥–æ–º `attempts_exhausted` (—Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é ¬´–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª), —á—Ç–æ–±—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–ª —Ä–µ—à–µ–Ω–∏—è –ø–æ retry

### **–®–∞–≥ 4.4 - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫**
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ê–≤–∏—Ç–æ, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ –ë–î
- –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –µ—Å—Ç—å - –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤—è–∑—å —Å –∞—Ä—Ç–∏–∫—É–ª–æ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π
- –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ—Ç - –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

## **–≠–¢–ê–ü 5: –í–∞–ª–∏–¥–∞—Ü–∏—è**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `container/worker/validation/mechanical.py` - –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (—Å—Ç–æ–ø-—Å–ª–æ–≤–∞ + —Ü–µ–Ω—ã)
- `container/worker/validation/ai.py` - –ò–ò-–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini 2.5-flash
- `container/worker/validation/__init__.py` - –ø—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
- `container/worker/database.py` - 4 –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- OpenAI Python SDK (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ requirements.txt)
- Gemini 2.5-flash —á–µ—Ä–µ–∑ Google AI Studio endpoint
- OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API: `https://generativelanguage.googleapis.com/v1beta/openai/`
- Async —á–µ—Ä–µ–∑ AsyncOpenAI client
- JSON response format –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è: –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è (50% –ø–æ—Ä–æ–≥) ‚Üí –ò–ò (70% –ø–æ—Ä–æ–≥)
- –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini 2.5-flash —á–µ—Ä–µ–∑ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ò–ò –∑–∞–¥–∞—á–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç: –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è, –∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —Ç—Ä–µ–±—É—é—â–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (fallback –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–∞–ª—å—à–µ)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSONB –¥–ª—è `validation_details` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:
  - **–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è**: `stage`, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –ø–æ –ø–æ–ª—è–º (`title`, `description`, `seller`, `all`) –∏ –±–ª–æ–∫ `price` —Å —Ü–µ–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º –ø–æ—Ä–æ–≥–æ–º –∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø–æ —Ü–µ–Ω–µ.
  - **–ò–ò**: `stage`, `model`, —Ä–µ—à–µ–Ω–∏–µ (`passed`/`rejected`/`error`), `reason` (–¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è (`fallback`, `raw_excerpt`) –ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ü–µ–Ω–æ–≤—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤: >3√ó –º–µ–¥–∏–∞–Ω—ã —Ç–æ–ø-20%
- Graceful degradation: –µ—Å–ª–∏ GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

### **–®–∞–≥ 5.1 - –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
–î–ª—è –≤—Å–µ—Ö —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω–∏–∫ –ø—Ä–æ–¥–∞–≤—Ü–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤
- –ü–æ–∏—Å–∫ –≤–µ–¥–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
- –°–ø–∏—Å–æ–∫ —Å—Ç–æ–ø-—Å–ª–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏: "–Ω–µ –æ—Ä–∏–≥–∏–Ω–∞–ª", "–∞–Ω–∞–ª–æ–≥", "–±/—É", "–±—É", "–±.—É", "–± —É" –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–µ–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤
- –û–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞–º–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ –Ω–µ–ø—Ä–æ—à–µ–¥—à–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é

**–¶–µ–Ω–æ–≤–æ–π –∞–Ω–∞–ª–∏–∑:**
- –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ —Ü–µ–Ω–µ
- –ë–µ—Ä–µ—Ç 20% —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö (–µ—Å–ª–∏ –º–µ–Ω—å—à–µ 5 –æ–±—ä—è–≤–ª–µ–Ω–∏–π - –±–µ—Ä–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ)
- –í—ã—á–∏—Å–ª—è–µ—Ç –∏—Ö —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É, –∏—Å–∫–ª—é—á–∞—è —è–≤–Ω—ã–µ –≤—ã–±—Ä–æ—Å—ã
- –û—Ç—Å–µ–∏–≤–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å —Ü–µ–Ω–æ–π –º–µ–Ω—å—à–µ 50% –æ—Ç —ç—Ç–æ–π —Å—Ä–µ–¥–Ω–µ–π

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ —Å —Ç–∏–ø–æ–º "–º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è"
- –í `validation_details` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ (–ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É/–æ–ø–∏—Å–∞–Ω–∏—é/–ø—Ä–æ–¥–∞–≤—Ü—É) –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ü–µ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º –ø–æ—Ä–æ–≥–æ–º

### **–®–∞–≥ 5.2 - –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ò-–∞–≥–µ–Ω—Ç–æ–º**
–û–±—ä—è–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Gemini 2.5-flash —á–µ—Ä–µ–∑ OpenAI Python SDK
- Endpoint: `https://generativelanguage.googleapis.com/v1beta/openai/`
- Async –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `AsyncOpenAI` –∫–ª–∏–µ–Ω—Ç
- Structured output —Å `response_format={"type": "json_object"}` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON
- –ú–æ–¥–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ –∏ —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:**
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å–æ –≤—Å–µ–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏, –ø—Ä–æ—à–µ–¥—à–∏–º–∏ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –í–∫–ª—é—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è –∏ —Ü–µ–Ω—ã –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ü–µ–Ω–æ–≤–æ–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä (—Å—Ä–µ–¥–Ω–µ–µ —Ç–æ–ø-20% –∏ –ø–æ—Ä–æ–≥ 70%)

**–ê–Ω–∞–ª–∏–∑ –ò–ò:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–≤—É–∞–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã —Ç–∏–ø–∞ "–∫–∞–∫ –æ—Ä–∏–≥–∏–Ω–∞–ª", "–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–ø–∏—è", "—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å")
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–Ω–æ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –Ω–∞—Ö–æ–¥–∏—Ç 20% —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö, —Å—á–∏—Ç–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é, –æ—Ç—Å–µ–∏–≤–∞–µ—Ç –¥–µ—à–µ–≤–ª–µ 70% –æ—Ç —Å—Ä–µ–¥–Ω–µ–π
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –¥–≤—É–º—è –º–∞—Å—Å–∏–≤–∞–º–∏: passed_ids –∏ rejected (—Å –ø—Ä–∏—á–∏–Ω–∞–º–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É validation_results —Å —Ç–∏–ø–æ–º "–ò–ò"
- –í `validation_details` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ (gemini-2.5-flash), —Ä–µ—à–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –±—ã–ª–∞)
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ –ò–ò - –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏ –ø–æ–º–µ—á–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫–∞–∫ `passed=False` —Å –ø—Ä–∏–∑–Ω–∞–∫–æ–º `fallback=json_decode_error`, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ï—Å–ª–∏ GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ò–ò-–≤–∞–ª–∏–¥–∞—Ü–∏—é —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –≤ –ª–æ–≥–∞—Ö

## **–≠–¢–ê–ü 6: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `container/worker/main.py` - —Ñ—É–Ω–∫—Ü–∏—è `parse_detailed_cards()` (~140 —Å—Ç—Ä–æ–∫)
- `container/worker/database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `get_cards_for_detailed_parsing()` –∏ `update_card_detailed_data()`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `worker_main_loop()` –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- `parse_card` –∏–∑ avito-library –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–∫—Å–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- Graceful degradation: –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π: `views_total` ‚Üí `views_count`

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥** (–æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –æ—á–µ—Ä–µ–¥–∏)
- **–ü—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫** (–Ω–µ –ª–æ–º–∞–µ–º –≤—Å—é –∑–∞–¥–∞—á—É –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏)
- **–§–∞—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏** (–∫–∞–ø—á–∞/–ø—Ä–æ–∫—Å–∏) ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å
- **Retry-safe**: —É–∂–µ —Å–ø–∞—Ä—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (`published_at IS NOT NULL`)
- **URL —Ñ–æ—Ä–º–∞—Ç**: `https://www.avito.ru/{avito_item_id}`

### **–®–∞–≥ 6.1 - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É**
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –æ–±–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- –í–æ—Ä–∫–µ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç URL: `https://www.avito.ru/{avito_item_id}`
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `page.goto()`
- –í—ã–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞:
  - **CAPTCHA** ‚Üí —Ä–µ—à–∞–µ—Ç —á–µ—Ä–µ–∑ `resolve_captcha_flow()`, –µ—Å–ª–∏ –Ω–µ —Ä–µ—à–µ–Ω–∞ ‚Üí –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É
  - **PROXY_BLOCKED** (403/407) ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–∫—Å–∏, –≤–æ–∑–≤—Ä–∞—Ç –∑–∞–¥–∞—á–∏
  - **NOT_DETECTED** / —É–¥–∞–ª–µ–Ω–∞ ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
  - **CARD_FOUND** ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥

### **–®–∞–≥ 6.2 - –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏**
–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –¥–µ—Ç–µ–∫—Ç–æ—Ä–µ –∫–∞—Ä—Ç–æ—á–∫–∏:
- –ü–æ–ª—É—á–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ `await page.content()`
- –ü–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ `parse_card(html, fields=[...])` –∏–∑ avito-library
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—è: `title`, `price`, `seller`, `item_id`, `published_at`, `description`, `location`, `characteristics`, `views_total`
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥: `views_total` ‚Üí `views_count`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `parsed_cards` —á–µ—Ä–µ–∑ `update_card_detailed_data()`
- –û–±–Ω–æ–≤–ª—è–µ—Ç `parsed_data` JSONB (merge —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
- –ü–æ–º–µ—á–∞–µ—Ç –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ `NOW()`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- `CardParsingError` ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É
- Timeout –Ω–∞ `page.goto()` ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç
- –ö–∞–ø—á–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤—Å–µ–π –∑–∞–¥–∞—á–∏ (retry)
- –ü—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤—Å–µ–π –∑–∞–¥–∞—á–∏ (retry)
- –ö–∞—Ä—Ç–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞ ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–æ—Å—Ç–∞—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞)

## **–≠–¢–ê–ü 7: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 3)**

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:
- `container/worker/database.py` - —Ñ—É–Ω–∫—Ü–∏—è `complete_task()`
- `container/worker/main.py` - –≤—ã–∑–æ–≤ –≤ `worker_main_loop()`

### **–®–∞–≥ 7.1 - –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è**
–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É (–∫–∞—Ç–∞–ª–æ–≥ + –≤–∞–ª–∏–¥–∞—Ü–∏—è + –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥):
- –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –Ω–∞ "–∑–∞–≤–µ—Ä—à–µ–Ω–∞" —á–µ—Ä–µ–∑ `UPDATE tasks SET status = '–∑–∞–≤–µ—Ä—à–µ–Ω–∞'`
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ç–∏–∫—É–ª –≤ —Ç–∞–±–ª–∏—Ü—É `processed_articles` —Å:
  - `processing_status`: 'success' | 'error' | 'no_results'
  - `items_found`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
  - `items_passed`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—à–µ–¥—à–∏—Ö –æ–±–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - `started_at`: –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - `worker_id`: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–æ—Ä–∫–µ—Ä–∞
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∑–∞–¥–∞—á—É (–æ–±–Ω—É–ª—è–µ—Ç `current_task_id`)

**–í–∞–∂–Ω–æ:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–∞–ª—å–Ω–æ —Å–ø–∞—Ä—à–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ `items_passed` - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø –æ–±–æ–≥–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### **–®–∞–≥ 7.2 - –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ**
- –í–æ—Ä–∫–µ—Ä **–ù–ï –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏** (–æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `current_proxy_id`)
- –í–æ—Ä–∫–µ—Ä **–ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä** (Playwright Page –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π)
- –ë–µ—Ä–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —á–µ—Ä–µ–∑ `take_next_task()`
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±—Ä–∞—É–∑–µ—Ä–∞ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–∞

## **–≠–¢–ê–ü 8: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±–æ–µ–≤**
**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 3)**

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:
- `container/worker/main.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `graceful_shutdown()`, `sigterm_handler()`, retry –ª–æ–≥–∏–∫–∞
- `container/worker/database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `return_stuck_tasks()`, `return_task_to_queue()`, `mark_task_as_error()`
- Docker Compose - –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### **–®–∞–≥ 8.1 - –ü–∞–¥–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞**
–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
- Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ–ª–∏—Ç–∏–∫–∞ `restart: always`)
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Ä–∫–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `return_stuck_tasks()`:
  - –ù–∞—Ö–æ–¥–∏—Ç –∑–∞–¥–∞—á–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "–≤ —Ä–∞–±–æ—Ç–µ" —Å `last_heartbeat` —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö —Å—Ç–∞—Ç—É—Å –≤ "–Ω–æ–≤–∞—è"
  - –û–±–Ω—É–ª—è–µ—Ç `worker_id` –∏ `taken_at`
- –í–æ—Ä–∫–µ—Ä –±–µ—Ä–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –∏ –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —á–∏—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### **–®–∞–≥ 8.2 - –§–∞—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏**
–ü—Ä–∏ —Ñ–∞—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∫—Å–∏, –Ω–µ—Ä–µ—à–∞–µ–º–∞—è –∫–∞–ø—á–∞):

**–í –∫–∞—Ç–∞–ª–æ–≥–µ:**
- –ü—Ä–∏ –∫–æ–¥–∞—Ö 403/407 –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏ –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∑—è—Ç—å –Ω–æ–≤—ã–π –¥–æ 5 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—è –±—Ä–∞—É–∑–µ—Ä –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è —Ç—É –∂–µ –∑–∞–¥–∞—á—É; –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∏–ª–∏ –∑–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–µ —É–¥–∞–ª—Å—è ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å (–±–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏—è retry –∏ –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞ `no_results`)
- –ü—Ä–∏ –Ω–µ—Ä–µ—à–µ–Ω–Ω–æ–π –∫–∞–ø—á–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ `release_proxy()`, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å (retry —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è)
- –í–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç cleanup –∏ –æ–±–Ω—É–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `current_proxy_id`, `playwright_instance`, `browser_instance`, `context_instance`, `page_instance`
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–º–µ–Ω—ã –ø—Ä–æ–∫—Å–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–æ–≥–æ –∂–µ –∞—Ä—Ç–∏–∫—É–ª–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏

**–í –¥–µ—Ç–∞–ª—å–Ω–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: 403/407 ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –Ω–µ—Ä–µ—à–µ–Ω–Ω–∞—è –∫–∞–ø—á–∞ ‚Üí –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏
- –£–∂–µ —Å–ø–∞—Ä—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ–∏–ª—å—Ç—Ä—É `published_at IS NOT NULL`

**–ü—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫ (3 retry):**
- –ü–æ–º–µ—á–∞–µ—Ç –∑–∞–¥–∞—á—É –∫–∞–∫ –æ—à–∏–±–∫–∞ —á–µ—Ä–µ–∑ `mark_task_as_error()`
- –ë–æ–ª—å—à–µ –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ—Ç –∞—Ä—Ç–∏–∫—É–ª

### **–®–∞–≥ 8.3 - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
**–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏:**
- –í–æ—Ä–∫–µ—Ä –ù–ï –±–µ—Ä–µ—Ç –∑–∞–¥–∞—á–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å (–±–µ–∑ increment_retry)
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É
- –ñ–¥–µ—Ç `NO_PROXIES_WAIT` —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
- –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É

**–ù–µ—Ç –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏:**
- –í–æ—Ä–∫–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç "–ù–µ—Ç –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏, –æ–∂–∏–¥–∞–Ω–∏–µ..."
- –ñ–¥–µ—Ç `NO_TASKS_WAIT` —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)
- –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É

**Graceful shutdown (SIGTERM):**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `running = False`
- –û—Ç–º–µ–Ω—è–µ—Ç heartbeat task
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î
- –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## **–ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

‚úÖ **–≠–¢–ê–ü 1**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚úÖ **–≠–¢–ê–ü 2**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚úÖ **–≠–¢–ê–ü 3**: –†–∞–±–æ—Ç–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –û–¢–õ–ê–ñ–ï–ù–û
‚úÖ **–≠–¢–ê–ü 4**: –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–∞–ª–æ–≥–∞ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –û–¢–õ–ê–ñ–ï–ù–û
‚úÖ **–≠–¢–ê–ü 5**: –í–∞–ª–∏–¥–∞—Ü–∏—è - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚úÖ **–≠–¢–ê–ü 6**: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚úÖ **–≠–¢–ê–ü 7**: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
‚úÖ **–≠–¢–ê–ü 8**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±–æ–µ–≤ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.** üéâ

–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ —Å–±–æ–µ–≤.
